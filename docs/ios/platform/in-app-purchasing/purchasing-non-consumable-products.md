---
title: Xamarin での非消費製品の購入
description: このドキュメントでは、デバイスに関係なく、無期限に使用可能なユーザーによって購入された機能である Xamarin. iOS の非使用製品について説明します。
ms.prod: xamarin
ms.assetid: 635D9CA2-6BCA-53E1-7B10-968029AA3493
ms.technology: xamarin-ios
author: davidortinau
ms.author: daortin
ms.date: 03/18/2017
ms.openlocfilehash: 6d87f99ae504346d55c4ddf86a093799ba9ddbd5
ms.sourcegitcommit: 008bcbd37b6c96a7be2baf0633d066931d41f61a
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/22/2020
ms.locfileid: "86936722"
---
# <a name="purchasing-non-consumable-products-in-xamarinios"></a>Xamarin での非消費製品の購入

非消費製品は顧客によって "所有" されます。 デバイスが紛失または盗難にあった場合や、新しいデバイスを購入した場合でも、常にアクセスできることが期待されます。 これらは、書籍、雑誌の問題、ゲームレベル、写真フィルター、' pro 機能 ' などに役立ちます。ユーザーは、使用されていない製品を購入した後に、もう一度支払いを行う必要はありません。 コードで誤って試行された場合、StoreKit は既に購入されていることを示すメッセージを表示します。

## <a name="non-consumable-products-sample"></a>非消費製品のサンプル

[InAppPurchaseSample コード](https://docs.microsoft.com/samples/xamarin/ios-samples/storekit)には、*非消耗品*と呼ばれるプロジェクトが含まれています。 このコードサンプルでは、例としてフォトフィルターを使用して非消費製品を実装する方法を示します。 フィルターを購入したら、それを何度も写真に適用できます。 再購入する必要はありません。   

購入プロセスは次の一連のスクリーンショットに示されています。 [**購入**] ボタンが [機能のアクティブ化] ボタンになります。   

 [![購入プロセスを次の一連のスクリーンショットに示します。](purchasing-non-consumable-products-images/image34.png)](purchasing-non-consumable-products-images/image34.png#lightbox)   

購入プロセスは、消費製品と同じです。重要な違いは、アプリケーションコードで購入を追跡する方法です。 この例では、製品がまだ購入されていない場合にのみ、[購入] ボタンを使用できます。それ以外の場合は、このボタンをクリックすると機能自体がアクティブになります。   

次の図は、クラスと App Store サーバーの間の相互作用を示しています。これにより、非消費製品購入が実行されます。   

 [![クラスと App Store サーバーの間の対話により、非消費製品購入を実行する](purchasing-non-consumable-products-images/image35.png)](purchasing-non-consumable-products-images/image35.png#lightbox)   

使用例との主な違いは、購入が完了すると、再購入を防ぐためにユーザーインターフェイスが更新されることです。 この例では、トランザクションの成功通知によってユーザーインターフェイスが更新され、[**購入**] ボタンが機能自体をアクティブにするボタンに変換されます。

## <a name="re-purchasing-non-consumable-products"></a>非消費製品の再購入

製品が正常に購入されると、コードでは通常、購入ボタンを非表示にしたり、再利用したりできます。これにより、ユーザーが製品を再び購入するのを防ぐことができます。 サンプルアプリケーションでこれを行うには、[**購入**] ボタンをボタンに変更します。これにより、例の写真フィルターが機能するようになります。   

アプリケーションで、非消費製品が既に購入されているかどうかを判断できない場合があります。

- アプリケーションが削除され、デバイスに再インストールされると、すべての購入レコードが失われます (ユーザーがバックアップ復元を実行するまで、またはその前に)。 
- ユーザーが2つ以上のデバイスにアプリケーションをインストールし、いずれかのデバイスで購入を行う場合。 他のデバイスは、引き続き購入可能な製品を示します。 
- お客様がこのような状況で使用されていない製品を再購入しようとした場合、App Store はその製品を無料でご利用いただけます。 ユーザーインターフェイスは最初に購入を実行するように表示されます (たとえば、確認アラートが表示され、Apple ID が必要になります)。ただし、ユーザーには、製品が既に購入されていることを示すメッセージが表示されます。  

このシナリオのコードパスは、通常の購入とまったく同じですが、唯一の違いは次のとおりです。

- ユーザーは、製品に対して再度請求されることはありません。
- アプリケーションに渡されたオブジェクトには、最初に製品を購入したときに生成された `SKPaymentTransaction` `OriginalTransaction` トランザクションを参照するプロパティがあります。 
- 非消費製品を販売するアプリケーションでは、ユーザーが既存の購入を取得できるように、StoreKit の**復元**機能も実装する必要があります。 
