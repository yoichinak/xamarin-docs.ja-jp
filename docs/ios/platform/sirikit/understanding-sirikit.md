---
title: SiriKit の概念の理解
description: このドキュメントでは、Xamarin iOS アプリで SiriKit を操作するために必要な主要概念について説明します。 たとえば、インテントとインテントの UI 拡張機能、SiriKit のアクセス許可、優れたエクスペリエンスの設計などについて説明します。
ms.prod: xamarin
ms.assetid: 99EC5C1E-484F-4371-8555-58C9F60DE37F
ms.technology: xamarin-ios
author: davidortinau
ms.author: daortin
ms.date: 05/02/2017
ms.openlocfilehash: 74c45a4e8880e1b9c98d11dd4874a4ecf569f0c0
ms.sourcegitcommit: 00e6a61eb82ad5b0dd323d48d483a74bedd814f2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/29/2020
ms.locfileid: "91433795"
---
# <a name="understanding-sirikit-concepts"></a>SiriKit の概念の理解

_この記事では、Xamarin iOS アプリで SiriKit を操作するために必要な主要な概念について説明します。_

IOS 10 の新機能である SiriKit を使用すると、Xamarin iOS アプリは、Siri と、iOS デバイス上の Maps アプリを使用して、ユーザーがアクセスできるサービスを提供できます。 この機能は、新しい **インテント** および **インテント UI** フレームワークを使用して1つ以上のアプリ拡張機能に用意されています。

SiriKit を使用すると、iOS アプリは、アプリ拡張機能と新しい **インテント** および **インテント UI** フレームワークを使用して、Ios デバイスで siri と Maps アプリを使用して、ユーザーがアクセスできるサービスを提供できます。

Siri は、 **ドメイン**の概念、関連するタスクの既知のアクションのグループと連携して機能します。 Siri を使用したアプリの相互作用は、次のいずれかの既知のサービスドメインに分類される必要があります。

- オーディオまたはビデオの呼び出し。
- 乗り物を予約します。
- ワークスペースの管理。
- メッセージング.
- 写真を検索しています。
- 支払いの送信または受信。

ユーザーがアプリ拡張機能のいずれかのサービスに関連する Siri の要求を行うと、SiriKit は、ユーザーの要求とサポートデータを記述する **インテント** オブジェクトを拡張機能に送信します。 その後、アプリ拡張機能は、指定された**インテント**に対して適切な**応答**オブジェクトを生成し、拡張機能が要求を処理する方法を詳述します。

## <a name="the-intents-and-intents-ui-extensions"></a>インテントとインテントの UI 拡張機能

Siri と Maps アプリは、次の2種類のアプリ拡張機能を使用して、アプリのサービスと対話します。

- **インテント拡張** -siri を提供し、アプリのコンテンツにマップして、サポートされているインテントを満たすために必要なタスクを実行します。
- **インテント Ui 拡張機能** -siri またはマップ内のアプリのコンテンツに対して表示されるカスタム UI を提供します。

このアプリは、SiriKit をサポートするインテント拡張機能を提供する必要があります。また、Siri とマップがユーザーに提示し、インテントを処理するための情報を提供する責任があります。

Siri は通常、すべてのユーザーの操作を処理します。また、サポートされている各ドメインに情報を提示するための標準の組み込み UI が用意されているため、インテント UI 拡張機能を作成することはできません。 インテント UI 拡張機能を提供することにより、アプリは **インテント ui** フレームワークを使用して、アプリのブランド化と追加情報を示す、豊富なカスタムユーザーインターフェイスを提供できます。

## <a name="siri-and-the-maps-app-role"></a>Siri と Maps アプリロール

ユーザーの声による要求は、Siri によって処理され、意味的に分析されます。これにより、インテント拡張が処理できるように、これらの要求が実用的なインテントになります。

Maps は、アプリのインテント拡張機能を使用して、ユーザーの操作に応答してマップインターフェイスに情報を表示します。 たとえば、近くのレストランを要求したり、アプリのレストランレビューを取得したりすることができます。

Siri とマップはどちらも、ユーザーのすべての対話を管理し、標準のシステムインターフェイスを使用して結果を表示します。 アプリの拡張機能の役割は、主に表示されるデータを提供することです。 必要に応じて、アプリはインテント UI 拡張機能を提供し、既定のシステムインターフェイスを拡張するためのカスタム UI を提示することができます。

## <a name="interacting-with-siri-via-sirikit"></a>SiriKit を使用した Siri との対話

このセクションでは、SiriKit を使用してユーザーがアプリと対話する方法の概要について説明します。 この例では、フェイク MonkeyChat アプリを使用します。

[![MonkeyChat アイコン](understanding-sirikit-images/monkeychat01.png)](understanding-sirikit-images/monkeychat01.png#lightbox)

MonkeyChat では、ユーザーの友人に固有の連絡先ブックが保持されます。各ユーザーは、(Bobo などのように) 画面名に関連付けられています。また、ユーザーは、画面名で各フレンドにテキストチャットを送信できます。

さまざまなユーザーがさまざまな形式で同じ要求を行う可能性があるため、ユーザーがアプリとの対話を開始する方法は多数あります。

たとえば、ユーザーが友人 Bobo にメッセージを送信する場合、Siri との次のメッセージ交換が必要になることがあります。

_ユーザー: 次のように、MonkeyChat メッセージを送信します。_<br />
_Siri: ユーザーはだれか。_<br />
_User: Bobo。_<br />
_Siri: Bobo とは何ですか。_<br />
_ユーザー: さらに Bananas を送信してください。_<br />

別のユーザーが別のメッセージ交換で同じ要求を行う場合があります。

_ユーザー: MonkeyChat で Bobo にメッセージを送信します。_<br />
_Siri: Bobo とは何ですか。_<br />
_ユーザー: さらに bananas を送信してください。_<br />

もう1つのユーザーは、さらに短い要求を行う可能性があります。

_ユーザー: MonkeyChat Bobo で、さらに bananas を送信してください。_<br />
_Siri: Ok、メッセージを送信しています。 Monkeychat で Bobo にさらに bananas を送信してください。_<br />

または、同じ要求を別の言語で行うこともできます。

_ユーザー: MonkeyChat Bobo ' il vous plaît envoyer + de bananes。_<br />
_Siri: Oui、envoi message ' il vous plaît envoyer + de bananes 氏 Bobo .sur Monkeychat。_<br />

それでも、他のユーザーがメッセージ交換で非常に冗長になる可能性があります。

_ユーザー: Siri です。優先して MonkeyChat アプリを起動して、メッセージと共にテキストを送信することができます。 bananas を送信してください。_<br />
_Siri: ユーザーはだれか。_<br />
_ユーザー: My best pal Bobo。_<br />

また、Siri が要求に応答する方法は多数あります。要求の作成方法によって異なります。

- **[ホーム] ボタン** を使用すると、siri は、口頭によるフィードバックが制限されたビジュアル応答を提供します。
- **"Siri" によって** 、siri はより言葉が多くなり、視覚的な応答が減ります。

また、siri はユーザーのユーザー補助のニーズに合わせて調整され、これらのニーズに基づいて対話および応答します。

要求がどのように行われたか、または Siri が要求にどのように応答するかにかかわらず、Siri はユーザーとのメッセージ交換を処理し、(拡張機能を使用して) アプリは機能を提供します。

ユーザーが Siri の口頭による要求を行うと、次のような手順で Siri が使用されます。

[![Siri が従う手順](understanding-sirikit-images/monkeychat02.png)](understanding-sirikit-images/monkeychat02.png#lightbox)

1. まず、Siri はユーザーの **音声** の音声を受け取り、それをテキストに変換します。
2. 次に、テキストは、ユーザーの要求の構造化表現である **インテント**に変換されます。
3. インテントに基づいて、Siri はユーザーの要求を実行する **アクション** を実行します。
4. 最後に、Siri は、実行されたアクションに基づいて、ユーザーに **応答** (視覚的と口頭の両方) を提示します。

Siri とのユーザーの会話にアプリを参加させるには、主に次の3つの方法があります。

[![Siri とのユーザーの会話にアプリが参加できる主な3つの方法](understanding-sirikit-images/monkeychat03.png)](understanding-sirikit-images/monkeychat03.png#lightbox)

1. **ボキャブラリ** -これは、アプリが情報を操作するために必要な単語を siri に伝えるためのものです。
2. **アプリロジック** -アプリが特定のインテントに基づいて実行するアクションと応答です。
3. **ユーザーインターフェイス** -アプリが応答を提供できる、省略可能なカスタムユーザーインターフェイスです。

### <a name="example"></a>例

上記の情報については、次のメッセージ交換が MonkeyChat アプリとどのように対話するかを確認してください。

_ユーザー: 次のように、MonkeyChat で Bobo にメッセージを送信します。_<br />
_Siri: Bobo とは何ですか。_<br />
_ユーザー: さらに bananas を送信してください。_<br />

アプリがメッセージ交換に使用する最初のロールは、ユーザーの音声を Siri が理解するのに役立ちます。

[![ユーザーの音声を Siri が理解できるようにする](understanding-sirikit-images/monkeychat04.png)](understanding-sirikit-images/monkeychat04.png#lightbox)

Siri では、データベースに "Bobo" という名前はありませんが、アプリはこの情報をボキャブラリを介して Siri と共有しています。 また、このアプリは、Bobo が受信者であることを Siri が認識するのにも役立ちます。これは、Siri を *連絡先*として指定したためです。

Siri は、受信者だけでなくメッセージを送信するためにより多くの要求が必要であることを認識しているため、アプリの拡張機能を使用して、メッセージにコンテンツが必要かどうかをすばやく確認します。 MonkeyChat が行われるため、Siri はユーザーに *"Bobo に言うべきこと*を指定してください" という質問が表示され、ユーザーに応答します。

上記の例では、ユーザーが *「より多くの bananas を送信してください」* というメッセージが表示され、siri が構造的な **目的**でバンドルされています。

[![Siri は、ユーザーの応答を構造化されたインテントにバンドルします。](understanding-sirikit-images/monkeychat05.png)](understanding-sirikit-images/monkeychat05.png#lightbox)

構造化インテントには、次の情報が含まれます。

- **ドメイン:** 送信
- **インテント:** sendMessage
- **受信者:** Bobo
- **コンテンツ:** さらに bananas を送信してください

すべてのドメインは、一連の既知の *アクション* を持つことができ、ドメインとアクションに基づきます。アプリに送信されるインテントには、0個以上のパラメーターが含まれる場合があります。

インテントは、処理のためにアプリ拡張機能に送信されます。 インテントを処理した結果として、アプリで **Intentresponse** が生成されます。これはインテントと共にバンドルされ、アプリの目的を説明するパラメーターが含まれます。

また、各 IntentResponse には、アプリが要求を完了できたかどうかを Siri に伝える **応答コード** も含まれています。 一部のドメインには、非常に具体的なエラー応答コードが含まれている場合もあります。

最後に、IntentResponse にはが含まれ `NSUserActivity` ます (ハンドオフのサポートに使用されるものと同様)。 `NSUserActivity`応答で Siri 環境のままにする必要がある場合は、を使用してアプリを起動し、完了するにはアプリを入力します。

Siri は、アプリケーションを開始するための適切なを自動的に作成 `NSUserActivity` し、siri 環境でユーザーが退職した場所をピックアップします。 ただし、必要に応じて、カスタマイズされた情報をアプリに提供することができ `NSUserActivity` ます。

アプリはインテントを処理し、Siri に応答を返した後、結果をユーザーに提示します (口頭で他者と視覚的の両方)。

[![口頭で他者と視覚的の両方の結果がユーザーに表示されます。](understanding-sirikit-images/monkeychat06.png)](understanding-sirikit-images/monkeychat06.png#lightbox)

Siri には、アプリで使用可能な各ドメイン用の組み込みの応答ユーザーインターフェイスがいくつか用意されています。 ただし、MonkeyChat には省略可能なインテント UI 拡張機能が用意されているため、これを使用して、上記の例のユーザーにメッセージ交換の結果を提示します。

## <a name="the-intent-lifecycle"></a>インテントライフサイクル

インテントを処理するときにアプリ拡張機能が実行する必要がある主なタスクは3つあります。

[![インテントライフサイクル](understanding-sirikit-images/monkeychat07.png)](understanding-sirikit-images/monkeychat07.png#lightbox)

1. アプリは、イベントのすべてのパラメーターを **解決** する必要があります。 その結果、アプリは、(各パラメーターにつき1回ずつ) Resolve を呼び出し、アプリとユーザーが要求されている内容に同意するまで同じパラメーターで複数回呼び出されることがあります。
2. アプリは、要求されたインテントを処理できることを **確認** し、期待される結果を siri に伝える必要があります。
3. 最後に、アプリはインテントを **処理** し、要求された結果を得るための手順を実行する必要があります。

### <a name="the-resolve-stage"></a>解決段階

解決段階は、ユーザーが指定した値を Siri が理解するのに役立ちます。また、ユーザーが実際に意図した内容を、アプリによって意図されたものであるかどうかを確認します。

この段階では、アプリがユーザーとのメッセージ交換中に Siri の動作に影響を与えることもあります。 これを行うために、アプリは **解決応答**を提供します。 Siri で認識されるさまざまな種類のデータに対する定義済みの応答がいくつかあります。

アプリからの最も一般的な解決策の応答は **成功**します。これは、アプリが、パラメーター (ユーザーの画面名など) の特定のデータを、認識している情報に一致させることを意味します。

特定の要求が、認識されている情報の正しい部分と一致することを確認する必要がある場合もあります。 このような場合は、 **ConfirmationRequired**の応答を送信して、 *"bobo にメッセージを送信*する" などの質問をユーザーに送信します。

場合によっては、ユーザーが短いオプションリストからアプリを選択する必要があります。 この場合、アプリは、次のようにユーザーが選択できる 2 ~ 10 個のオプションのリストを使用して、 **不明瞭** な応答を提供します。

```csharp
Who do you want to message?

* Bobo the Great
* Bobo Jr.
* Little Bobo
```

Siri は、口頭で他者または Siri UI との対話によって選択を行うユーザーを処理し、結果はアプリに送り返されます。

それ以外の場合は、アプリケーションがパラメーターを解決するために必要な情報が不足しているか、あいまいさを使用して解決する一致が多すぎる可能性があります (たとえば、名前に Bobo がある80ユーザー)。 この場合、アプリは **NeedsMoreDetails** 応答を送信し、siri はユーザーにより具体的なプロンプトを表示します。

ユーザーが目的を処理するために必要な値を指定しなかった場合は、ユーザーに対して Siri に対して値の入力を求めるため **に、必要** な値を送信できます。

ユーザーが特定のパラメーターに指定した値をアプリがサポートしていない場合、 **Unsupportedwithreason** 応答を送信して、その値がサポートされていなかった理由を示すことができます。 その後、siri は、ユーザーに完全に新しい値を要求し、必要な理由を提示します。

最後に、 **NotRequired** 応答を使用して、アプリが特定のパラメーターの値を必要としないことを siri に伝えます。 ユーザーがいずれかを指定した場合は、Siri によって無視されます。

### <a name="the-confirm-stage"></a>確認段階

Confirm ステージには次の2つの目的があります。

- Siri がユーザーに何が起こっているかをユーザーに通知できるように、インテントの処理に期待される結果を Siri に伝えること。
- 要求された支払いを行うために銀行に十分な金額があるなど、アプリがユーザーによって提示された要求を完了するために必要な状態を確認する機会を提供します。

アプリは [確認] ステップから **インテント応答** を提供します。これには、アプリケーションが使用可能な情報を入力して、siri がユーザーと効果的に通信できるようにする必要があります。

ドメインとアクションの種類に基づいて、Siri は、支払いの送信や乗り物の予約などの確認をユーザーに求めます。

### <a name="the-handle-stage"></a>ハンドルステージ

ハンドルステージは、アプリが要求されたタスクを実行することによってユーザーの要求を処理するポイントであるため、インテントを操作するための最も重要な部分です。

確認段階で行ったのと同じように、アプリは、可能な限り多くの情報を提供する必要があるため、Siri はこれをユーザーに関連付けることができます。 この情報が視覚的に表示される場合や、Siri によってユーザーに読み上げられる場合があります。

特定の要求を処理するのに余分な時間が必要になる場合があります。たとえば、ネットワーク呼び出しの遅延や、ユーザーが要求を満たす必要がある場合などです (注文の完了と出荷や、ユーザーの所在地への車の運転など)。 Siri は、アプリからの応答を待機しているときに、アプリが要求を処理していることをユーザーに示す待機中の UI を表示します。

理想的には、アプリは、最大で 2 ~ 3 秒以内に Siri への応答を提供する必要があります。 特定の応答の処理に時間がかかることをアプリが認識している場合、 **その応答コード** を siri に送信する必要があります。 次に、siri は、アプリがバックグラウンドで要求を処理していることをユーザーに通知し、Siri 環境から離れる場合でも、この処理を続行します。

## <a name="adding-sirikit-to-the-app"></a>アプリケーションへの SiriKit の追加

IOS 10 の SiriKit では、Apple によって次の2つの新しい拡張ポイントが作成されました。

- **インテント拡張** -アプリケーションのコンテンツに siri を提供し、サポートされているインテントを満たすために必要なタスクを実行します。
- **インテント Ui 拡張** -siri 内のアプリコンテンツに対して表示されるカスタム UI を提供します。

また、次の形式で認識できるように、Siri に単語や語句を提供する API もあります。

- **アプリのボキャブラリ** -アプリのすべてのユーザーに共通の語句と語句。
- **ユーザーボキャブラリ** -特定のアプリユーザーに固有の単語と語句。

## <a name="the-intents-extension"></a>インテント拡張

インテント拡張は、次のように、アプリと Siri の間の主なやり取りを処理します。

[![インテント拡張](understanding-sirikit-images/intents01.png)](understanding-sirikit-images/intents01.png#lightbox)

インテント拡張では、1つ以上のインテントをサポートできます。開発者は、アプリで SiriKit を実装する方法を決定します。 開発者は、処理する必要がある各インテントに対して、個別のインテント拡張を追加することもできます。  しかし、Apple は、開発者がインテント拡張機能の数を制限して、Siri がアプリに対して複数のプロセスを開いていないことを要求します。これにより、より多くのメモリと処理時間が必要になります。

開発者は、Siri がアクティブになっている間に、インテント拡張がバックグラウンドで実行されることにも注意する必要があります。 これにより、Siri はユーザーとのメッセージ交換をアクティブに実行しながら、拡張機能と通信して要求に関する情報を処理することができます。

## <a name="privacy-and-security-considerations"></a>プライバシーとセキュリティに関する考慮事項

Apple は、Siri を使用するときにユーザーのプライベート情報が安全であることを確認するための優れた手段を採用しており、ユーザーが iOS デバイスにログインする必要がある対話がいくつかあります。 たとえば、乗り物を要求したり、支払いを行ったりする場合です。

また、デバイスにログインしているユーザーに制限することが必要な特定の動作があります。 このような状況では、アプリは **ロック中に制限** された動作を要求できます。 これは、ファイルの設定によって行われ `Info.plist` ます。

ローカル認証フレームワークはインテント拡張に使用できます。これにより、デバイスが既にロック解除されている場合でも、アプリはユーザーに追加の認証情報を要求できます。

最後に、インテント拡張機能で Apple Pay を使用できるため、アプリは Apple Pay を使用してトランザクションを完了できます。また、組み込みの Apple Pay シートが Siri インターフェイスの上に表示されます。

さらに、Apple は、サードパーティのアプリに情報を送信するタイミングをユーザーが認識できるようにしたいと考えています。ユーザーは、要求を行うときに (アプリのバンドル表示名で指定された) アプリの特定の名前を伝える **必要があり** ます。

Apple では、ユーザーとの自然な流動的な会話を実行するために Siri を設計しています。そのため、ユーザーの要求に自然に収まる場所であれば、アプリのバンドル名を音声の多くの部分で使用できます。

ユーザーがよく行うことの1つは、アプリの名前を "verbify" することです。つまり、アプリ名を取得し、それを要求の動詞として使用します。 たとえば、 *"Monkeychat Bobo はすばらしい bananas でした。"*

## <a name="the-intents-ui-extension"></a>インテント UI 拡張機能

インテント UI 拡張機能は、アプリの UI とブランド化を Siri エクスペリエンスに導入し、ユーザーがアプリに接続できるようにする機会を提供します。 この拡張機能を使用すると、アプリは、視覚情報やその他の情報などの情報をトランスクリプトに取り込むことができます。

[![インテント UI 拡張出力の例](understanding-sirikit-images/intents02.png)](understanding-sirikit-images/intents02.png#lightbox)

インテント UI 拡張機能は常にを返し、 `UIViewController` アプリはビューコントローラー内の任意のものを追加できます。たとえば、最初の応答を超える追加情報が表示されます。 インテント UI では、実行時間の長いイベントの状態でユーザーを更新することもできます。たとえば、車両の場所に到着するまでの時間を長くすることができます。

インテント UI 拡張は、常に、アプリのアイコンや名前などの他の Siri コンテンツと共に表示されます。また、目的に応じて、ボタン ([送信] や [キャンセル] など) が下部に表示される場合もあります。

アプリケーションで、Siri が表示する情報を既定でユーザーに置き換えることができるインスタンスがいくつかあります。このような場合、アプリは既定のエクスペリエンスをアプリに合わせて置き換えることができます。

> [!IMPORTANT]
> またはのような対話型の要素を `UIButtons` `UITextFields` インテント Ui 拡張機能に追加することはできますが、これらは、 `UIViewController` 非対話型のインテント ui として厳密には禁止されているため、ユーザーは対話できません。

Siri には各インテント型の既定の UI セットが含まれているため、アプリでインテント UI 拡張機能を提供することは完全にオプションです。 また、インテント UI インターフェイスは、Apple によってユーザーにとって役に立つと思われる特定のインテントにのみ使用できます。

## <a name="adding-sirikit-vocabulary"></a>SiriKit ボキャブラリの追加

SiriKit を実装する最後の部分は、必要なボキャブラリを提供することで、アプリ内に存在します。 多くのアプリには、ユーザーに情報を記述する独自の方法と、ユーザーがアプリに情報を提供するための独自の方法があります。

このため、Siri では、アプリに固有の単語や語句を理解するためにアプリのサポートが必要です。 これらのフレーズの一部は、すべてのユーザーが認識して理解できるように、アプリの一部として使用されます。 ただし、他のユーザーはアプリの特定のユーザーに対して一意です。

### <a name="app-specific-vocabulary"></a>アプリ固有のボキャブラリ

アプリ固有のボキャブラリは、車両の種類やトレーニング名など、アプリのすべてのユーザーに認識される特定の語と語句を定義します。 これらはアプリケーションの一部であるため、 `AppIntentVocabulary.plist` メインアプリケーションバンドルの一部としてファイルで定義されます。 また、これらの単語と語句はローカライズする必要があります。

ボキャブラリファイルにはいくつかの部分があり `AppIntentVocabulary.plist` ます。

- **アプリの使用例** -ユーザーがアプリを作成できる要求に対して一般的なユースケースのセットを提供します。 たとえば *、"MonkeyFit でトレーニングを開始する" と*いうことです。
- **Parameters** -アプリに固有の標準ではないパラメーターの種類のセットが用意されています。 たとえば、MonkeyFit アプリのトレーニング名があります。 次の要素で構成されます。
  - [**語句**-アプリで一意の用語を定義できるようにします。 例: MonkeyFit アプリの "Bananarific" トレーニングの種類。
  - **発音** -特定の語句の簡単な発音の綴りを siri に示します。 たとえば、"ba nana ri f)" のようになります。
  - **例** -アプリで特定の語句を使用する例を示します。 たとえば、 *"MonkeyFit で Bananarific を開始する"* とします。

詳細については、「Apple の [アプリボキャブラリファイル形式リファレンス](https://developer.apple.com/library/prerelease/content/documentation/Intents/Conceptual/SiriIntegrationGuide/CustomVocabularyKeys.html#//apple_ref/doc/uid/TP40016875-CH10-SW1)」を参照してください。

### <a name="user-specific-vocabulary"></a>ユーザー固有のボキャブラリ

ユーザー固有の語彙は、アプリの個々のユーザーに固有の語句を提供します。 これらは、(アプリの拡張ではなく) メインアプリから実行時に提供され、ユーザーにとって最も重要な使用優先度で順序付けされた一連の用語として提供されます。一覧の先頭に最も重要な用語があります。

前に示した MonkeyChat アプリの例を見てみましょう。 MonkeyChat は、ユーザーのすべての連絡先の一覧を保持し、ユーザー固有の語彙を介して Siri に送信します。 また、ユーザーがメッセージした最新の10件の連絡先の一覧を保持し、ユーザーごとに一連のお気に入りの連絡先を持っています。 この例では、お気に入りの連絡先は、ユーザー固有の語彙の先頭にあり、その後、最近の連絡先の後にユーザーの連絡先の残りの部分が続きます。

ユーザー固有の語彙では、次の種類の情報がサポートされています。

- 連絡先の名前。
- トレーニング名。
- フォトアルバム名。
- フォトキーワード。

アプリが iOS アドレス帳に依存している場合、この情報は既に Siri で利用可能であるため、アプリは何の操作も行う必要はありません。 アプリが連絡先の一意のデータベースを所有している場合にのみ、連絡先の名前を指定する必要があります。

ボキャブラリを設計するときは、ユーザーが理解しておく必要のある値のみを指定します。 電話番号や電子メールアドレスなどの情報を提供することは避けてください。

アプリでは、ユーザー固有のボキャブラリが変更されたときに Siri をすぐに更新する必要もあります。 ユーザーは、iOS デバイスに追加された瞬間に Siri から情報を要求することに慣れています。 たとえば、ユーザーがアプリに新しい連絡先を追加した場合、ユーザーが保存した後すぐにその情報を Siri に送信します。

さらに重要な点として、アプリは Siri ボキャブラリから情報を削除 _する必要があり_ ます。これは、ユーザーが情報の一部を削除しても、siri がその時間または数日後に認識していたためです。

> [!IMPORTANT]
> ユーザーがアプリのリセットを選択した場合、またはログアウトした場合、アプリはユーザー固有のボキャブラリをすべて Siri から削除する必要があります。

## <a name="sirikit-permissions"></a>SiriKit のアクセス許可

SiriKit の最後の部分は、アクセス許可を中心にしています。 IOS の他の機能 (写真、カメラ、連絡先など) を使用する場合と同様に、ユーザーは、Siri と対話するために、アプリに対する明示的なアクセス許可を付与する必要があります。

アプリは、Siri にどのような情報を提供するかを定義する文字列を提供し、ユーザーがこのアクセス権を付与する必要がある理由を指定できます。

Apple は、iOS 10 にアップグレードした後、ユーザーが初めてアプリを開いたときに、Siri を使用するアクセス許可をユーザーに要求することをお勧めします。 これは、ユーザーが Siri 統合について理解し、最初の要求を行う前に事前承認済みの使用ができるようにするためです。

## <a name="sirikit-and-maps"></a>SiriKit と Maps

SiriKit は iOS の不可欠な部分であり、iOS 10 に追加された大規模なインテントフレームワークを利用します。 インテントフレームワークは、システムの他の部分と共通および共有のアクションとインテントを共有するように設計されています。

インテントフレームワークは、Siri 統合だけでなく、連絡先の統合などの他の機能を提供します。この場合、アプリは特定の連絡先の既定のテレフォニーまたはメッセージングアプリになることができます。 インテントは CallKit と緊密に統合されているため、ユーザーは可能な限り最適な VOIP エクスペリエンスを提供できます。

IOS 10 の Maps アプリには、ユーザーが Maps UI 内で直接乗り物を予約できるようにする、乗り物共有などの機能が追加されています。 SiriKit は、マップを含む共通の拡張ポイントを提供します。これにより、乗り物共有 (およびその他) インテントを Siri とマップ間で共有できます。

これは、アプリが SiriKit 拡張機能を採用している場合、マップの統合も無料で利用できることを意味します。

## <a name="designing-a-great-siri-experience"></a>優れた Siri エクスペリエンスの設計

アプリケーションを Siri に統合する場合の優れたユーザーエクスペリエンスの設計は、優れたアプリユーザーインターフェイスの設計とは異なります。 ユーザーが画面上で直接アプリを操作している通常の状況とは異なり、Siri を使用する場合は、ビジュアルインターフェイスがまったく表示されないことが何度もあります。 たとえば、ユーザーが *"こんにちは Siri"* を使用してメッセージ交換を開始したとします。

### <a name="how-siri-helps-the-developer"></a>開発者が Siri を使用する方法

Siri を使用したアプリの相互作用を設計する場合、アプリは会話 *インターフェイス*を構築します。つまり、コンテキストは、siri がユーザーとアプリの代わりに持っているメッセージ交換から派生します。

ビジュアル参照が存在しない場合、ユーザーは、先頭に表示されている情報を追跡する必要があります。 このため、Siri は、ユーザーが実行しようとしているタスクを実現するために必要な最小限の情報を提示します。

会話のインターフェイスは、メッセージ交換中のユーザーと Siri の両方からの質問と応答によって形成されます。 このため、Siri が質問をして、このインターフェイスを設計するときに応答する方法を検討することが重要です。

メッセージを作成するユーザーの例を次に示します。 Siri は、 *"送信準備ができて*います" という質問で応答することがあります。 ユーザーは、 *"送信する"*、 *"キャンセル"* 、この質問に完全には関係のない方法など、さまざまな方法で対応できます。 メッセージ交換がどのように動作するかにかかわらず、Siri はアプリに対してそれを処理し、使用可能になったときにのみ関連情報を送信します。

ユーザーが Siri とのメッセージ交換を開始するには、いくつかの方法があります。

- デバイスを選択し、[ホーム] ボタンを押します。 このような状況では、Siri はより多くのビジュアルインターフェイスを提供し、口頭による応答が少なくなります。
- *「こんにちは」* と言って、実際の会話を開始します。 このような状況では、Siri の方が視覚で言葉が少なくなります。
- Bluetooth を有効にするなどのユーザー補助機能を使用すると、特別なニーズに応じて UI をカスタマイズすることができます。
- 車 Play を使用します。ユーザーは、取られるを最小限に抑えることで、運転に重点を置く必要があります。

### <a name="how-the-developer-helps-siri"></a>開発者が Siri にどのように役立つか

アプリケーションを Siri と統合する場合、開発者はこの統合を頻繁にテストし、同じ情報やタスクを可能な限りさまざまな方法で要求することによって、さまざまな要求を行うことを確認する必要があります。

2人の人が似ているとは限りません。そのため、開発者は、Siri 統合を微調整するためにできるだけ多くのベータテスターを取得することが重要です。 ユーザーは情報を要求したり、開発者がそれを行うことができない方法で要求を行ったりすることがあります。この微調整は、アプリケーションを Siri で使用することにより、幅広いユーザーのグループに優れたエクスペリエンスを提供するのに役立ちます。

さまざまな状況や環境でテストします。 これらのメッセージ交換が流動的で自然な状態になるように、可能な限りすべての方法で Siri との会話を開始します。 混雑しているジムのように、ユーザーがアプリを使用する可能性が高い場所でテストします。

アプリケーションが、Siri が要求と結果を適切に表すために必要なすべての情報をユーザーに提供していることを確認します。 これは、Siri を実際に使用する場合に特に当てはまります。

### <a name="siri-design-guidelines"></a>Siri のデザインガイドライン

Siri は、アプリの代わりにユーザーとのメッセージ交換を行うことに注意してください。 開発者は、このメッセージ交換が可能な限り流動的で自然な状態であることを確信する必要があります。

重要なメッセージ交換の場合と同様に、開発者は次のことを保証する必要があります。

- アプリがメッセージ交換用に準備されていることを示します。
- アプリは、ユーザーが実行しようとしている内容を正確にリッスンします。
- アプリが適切なタイミングで適切な質問を求めます。
- アプリが要求に対して、ユーザーが求めている情報を使用して応答します。

#### <a name="preparing-for-the-conversation"></a>メッセージ交換の準備

最初に覚えておくべきことは、アプリのユーザーが開発者とまったく同じではないということです。 アプリを操作する際には、さまざまな背景から、異なる言語を使用したり、特別なニーズが生じたりする可能性があります。

さらに、開発者がアプリを設計して構築したため、アプリとその内部の動作、および一般的なユーザーにはない機能の詳細な知識があります。 そのため、開発者は、通常のユーザーとは異なる方法で Siri の要求を行うことができます。

このため、Siri 経由でアプリと対話できるようにするには、さまざまな人員を用意することが重要です。 ユーザーは、開発者が検討したことのない、または開発者の考えられていない方法で、アプリケーションの要求を Siri 経由で行うことができます。

#### <a name="ensure-the-app-is-a-good-listener"></a>アプリが適切なリスナーであることを確認する

開発者は、アプリが適切なリスナーであること、およびユーザーの期待を満たすメッセージ交換の詳細を取得していることを確認する必要があります。 ただし、要求されたタスクを実現するためにアプリが必要とするすべての情報が提供されていない可能性もあります。

アプリがこの状況に対処するには、次のようないくつかの方法があります。

- **欠損値に対して適切な既定** 値を選択します。たとえば、乗り物共有アプリでは、取得する場所を指定しなかった場合、既定ではユーザーの現在の場所が使用されます。
- **知識のある推測を行う** -アプリがユーザーに対して収集した特定の情報を使用すると、ユーザーの連絡先情報から不足している携帯電話の番号を入力するなど、不足している情報をアプリが推測して推測できる可能性があります。 ただし、最もコストの高いオプションを選択するなど、問題が発生しないように注意する必要があります。
- **詳細情報の入力を求める** -アプリは、不足値についてユーザーに対して siri プロンプトを表示することができます。 ただし、ここで重要なのは、メッセージ交換を単純にしてポイントすることです。 ユーザーは、要求を達成するためにいくつかの質問に回答する必要がある場合、すぐに不満になります。
- **間違った情報を適切に処理** する-ユーザーは、アプリが想定していなかった値、または特定のコンテキストで処理できない値を提供する場合があります。 アプリがこのような状況をユーザーに関連付けていることを確認します。

アプリに問題がある1つの値が表示された場合は、Siri でユーザーに確認を求めることをお勧めします。 たとえば、 *"Bobo はすばらしいと思いましたか?"* で、単純な [はい] または [いいえ] の答えで返信できます。

1つの値に対していくつかの選択肢が適切な場合は、あいまいさを解消する方法をお勧めします。 このような状況では、Siri はユーザーに対して最大10個のオプションを選択できます。 次に例を示します。

```csharp
Who do you want to send the message to?

* Bobo the Great!
* Bobo Jr.
* Little Bobo
```

まだ問題が解決しない場合は、特定の値に対して完全に新しい、より具体的な回答を提供するように Siri に指示します。

#### <a name="request-final-confirmation"></a>要求の最終確認

アプリが実際にユーザーの要求を満たすためにタスクを実行する前に、Siri はアプリの拡張機能を確認して、すべてが満たされていることを確認します。 たとえば、ユーザーのアカウントには、要求された支払いを行うのに十分な金額があるかどうかを確認できます。

さらに、アプリケーションは、Siri に対して可能なすべての情報を提供していることを確認する必要があります。これにより、ユーザーに提示され、実行するタスクが期待どおりであることを確認できます。

ユーザーが要求を確認し、アプリがそれを実行した後、アプリは、ユーザーに関連付けられるように、すべての結果が Siri に返されたことを確認する必要があります。

#### <a name="responding-to-the-request"></a>要求への応答

Siri には、認識しているドメインとアクションごとに、いくつかの組み込みのユーザーインターフェイスがあります。 ただし、必要に応じて、アプリのブランド化と UI、要求に含まれる情報よりも詳細な情報を提示することで、ユーザーエクスペリエンスを向上させるためのカスタムのインテント UI 拡張機能を提供できます。

ただし、このガイドは、Siri 用のカスタムインターフェイスを設計するときに使用する必要があります。 通常、ユーザーは、可能な限り迅速に特定のタスクを実行し、不要な情報を使用しないようにする必要があります。

また、ユーザーがデバイスを所有しているか使用している可能性があるさまざまな iOS デバイスとその向きで、カスタム UI が正しく表示され、応答するように注意する必要があります。

必要に応じて、SiriKit API を使用して、既定の Siri UI に既に存在する冗長情報を非表示にします。 ただし、アプリが引き続き Siri に情報を提供していることを確認してください。これにより、口頭で他者が手のかかる状況になる可能性があります。

ユーザーが要求した写真を表示するなど、ユーザーの要求を満たすために Siri がアプリを起動する場合があります。 このような状況では、ユーザーを驚かないでください。 中間手順や詳細な操作を必要としない、予想される情報を表示します。 ユーザーが想定していない情報を表示したり、タスクを実行したりしないでください。

### <a name="polishing-the-design"></a>設計の細か

会話インターフェイスの設計を整えるために Apple が提案するいくつかの手順があります。 まず、明確で簡潔なボキャブラリとユースケースの例を Siri に提供します。

ユーザーがアプリを検出する方法の1つは、Siri を使用してメッセージ交換を開始し、 *「何ができるか*」とたずねることです。 Siri では、開発者のアプリや、ファイルを介して提供されるヒーローの例を含む、さまざまなことが可能 `plist` です。

適切な例のユースケースを記述する方法:

- 例にアプリケーション名が含まれていることを確認します。
- 例を短くして、そのままにしておきます。
- アプリがサポートする各インテントに対して複数の例を提供します。
- アプリの最も一般的なユースケースに基づいて、これらの中のインテントと例の両方に優先順位を付けます。
- アプリがローカライズされた例を提供していることを確認します。
- 指定された各例がアプリ内で期待どおりに動作することを確認します。
- この例では Siri に対処しないでください。そのため、 *"こんにちは*。" というテキストを含めないでください。
- "Pleasantries" や *"礼状*" など、不要なものは避けて*ください*。

適切な時間を取って、Siri がユーザーに代わって行っているメッセージ交換をアプリがどのように整形しているかを調べ、試してみることができます。 とのやり取りとアプリの期待が経時的に変わる可能性があるため、プロセス全体で一般的なユーザーと話し合ってください。

常に、さまざまな状況でアプリをテストし、Siri を使用してメッセージ交換を呼び出すためにすべての異なるメソッドを使用してください。 実際の場所で、ユーザーがアプリを使用している可能性があり、オフィスやデスクから離れた場所でテストします。

Siri との会話 (アプリに代わって) を使用することは、自然で、自然であると言えます。

## <a name="summary"></a>まとめ

この記事では、SiriKit を使用するために必要な主要な概念について説明しました。また、この記事では、Xamarin iOS アプリと対話して、Siri および iOS デバイス上の Maps アプリを使用してユーザーがアクセスできるサービスを提供することができます。

## <a name="related-links"></a>関連リンク

- [サンプルの登録 zach](/samples/xamarin/ios-samples/ios10-elizachat)
- [SiriKit プログラミングガイド](https://developer.apple.com/library/prerelease/content/documentation/Intents/Conceptual/SiriIntegrationGuide/index.html)
- [インテントフレームワークリファレンス](https://developer.apple.com/reference/intents)
- [インテント UI フレームワークリファレンス](https://developer.apple.com/reference/intentsui)